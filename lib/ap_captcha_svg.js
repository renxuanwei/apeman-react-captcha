/**
 * SVG captcha.
 * DO NOT use svg base captcha in production, since it may be parsable by bots.
 * You need to convert to bitmap like png beforehand.
 * @constructor ApCaptchaSvg
 */

"use strict";

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

const React = require('react'),
      ReactDOM = require('react-dom'),
      randomval = require('randomval'),
      numcal = require('numcal'),
      types = React.PropTypes;

/** @lends ApCaptchaSvg */
let ApCaptchaSvg = React.createClass({
    displayName: 'ApCaptchaSvg',

    //--------------------
    // Specs
    //--------------------

    propsTypes: {
        version: types.string,
        text: types.string.isRequired,
        width: types.number,
        height: types.number
    },

    getDefaultProps: function () {
        return {
            version: '1.1',
            xmlns: 'http://www.w3.org/2000/svg',
            text: null,
            width: 240,
            height: 120
        };
    },

    render: function () {
        let s = this,
            props = s.props;

        let color = '#555';
        let text = props.text.split('').map((letter, i, letters) => {
            let indices = [0, 1, 2, 3, 4, 5],
                real = randomval.randomInt(0, indices.length - 1);

            let texts = indices.map(j => {
                let rate = (i + 0.5) / letters.length,
                    key = `letter-${ i }-${ j }`;
                if (j === real) {
                    return s._renderLetter(letter, rate, {
                        key: key,
                        fill: color
                    });
                } else {
                    return s._renderLetter(s._dummyLetter(), rate, {
                        key: key,
                        fill: `rgba(255,255,255,${ 0.01 * Math.random() })`
                    });
                }
            });
            return React.createElement(
                'g',
                { key: `letter-group-${ i }` },
                texts
            );
        });
        let width = props.width,
            height = props.height;
        return React.createElement(
            'svg',
            { version: props.version,
                width: width,
                height: height,
                viewBox: `0 0 ${ width } ${ height }`
            },
            React.createElement(
                'g',
                null,
                text
            )
        );
    },

    //--------------------
    // Specs
    //--------------------

    _renderLetter: function (letter, rate, textProps) {
        let s = this,
            props = s.props;

        let padding = 8;

        let w = props.width - padding * 2,
            h = props.height;

        let moveRange = numcal.min(h / 10, 20),
            move = randomval.randomInt.bind(randomval, moveRange * -1, moveRange);

        let x = padding + w * rate + move(),
            y = h / 2 + move(),
            rotate = randomval.randomInt(-45, 45);

        return React.createElement(
            'text',
            _extends({ x: x,
                y: y,
                fontSize: h / 3,
                transform: `rotate(${ rotate }, ${ x }, ${ y })`
            }, textProps),
            letter
        );
    },

    _dummyLetter: function () {
        const letters = "1234567890abcdefg";
        let len = letters.length;
        return letters[randomval.randomInt(0, len - 1)];
    }

});

module.exports = ApCaptchaSvg;
//# sourceMappingURL=data:application/json;base64,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QUMsRUFBRSxHQUFFLENBQUMsRUFBQyxFQUFFLEdBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQyxBQUFDO2VBQ3pDLFNBQVM7WUFDZixNQUFNO1NBQVEsQ0FDbkI7S0FDSjs7QUFFRCxnQkFBWSxFQUFFLFlBQVk7QUFDdEIsY0FBTSxPQUFPLEdBQUcsbUJBQW1CLENBQUM7QUFDcEMsWUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztBQUN6QixlQUFPLE9BQU8sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNuRDs7Q0FFSixDQUFDLENBQUM7O0FBRUgsTUFBTSxDQUFDLE9BQU8sR0FBRyxZQUFZLENBQUMiLCJmaWxlIjoiYXBfY2FwdGNoYV9zdmcuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL29rdW5pc2hpdGFrYS9wcm9qZWN0cy9hcGVtYW4tcmVhY3QtbGFiby9hcGVtYW4tcmVhY3QtY2FwdGNoYS9saWIvanN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTVkcgY2FwdGNoYS5cbiAqIERPIE5PVCB1c2Ugc3ZnIGJhc2UgY2FwdGNoYSBpbiBwcm9kdWN0aW9uLCBzaW5jZSBpdCBtYXkgYmUgcGFyc2FibGUgYnkgYm90cy5cbiAqIFlvdSBuZWVkIHRvIGNvbnZlcnQgdG8gYml0bWFwIGxpa2UgcG5nIGJlZm9yZWhhbmQuXG4gKiBAY29uc3RydWN0b3IgQXBDYXB0Y2hhU3ZnXG4gKi9cblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbmNvbnN0IFJlYWN0ID0gcmVxdWlyZSgncmVhY3QnKSxcbiAgICBSZWFjdERPTSA9IHJlcXVpcmUoJ3JlYWN0LWRvbScpLFxuICAgIHJhbmRvbXZhbCA9IHJlcXVpcmUoJ3JhbmRvbXZhbCcpLFxuICAgIG51bWNhbCA9IHJlcXVpcmUoJ251bWNhbCcpLFxuICAgIHR5cGVzID0gUmVhY3QuUHJvcFR5cGVzO1xuXG4vKiogQGxlbmRzIEFwQ2FwdGNoYVN2ZyAqL1xubGV0IEFwQ2FwdGNoYVN2ZyA9IFJlYWN0LmNyZWF0ZUNsYXNzKHtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBTcGVjc1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIHByb3BzVHlwZXM6IHtcbiAgICAgICAgdmVyc2lvbjogdHlwZXMuc3RyaW5nLFxuICAgICAgICB0ZXh0OiB0eXBlcy5zdHJpbmcuaXNSZXF1aXJlZCxcbiAgICAgICAgd2lkdGg6IHR5cGVzLm51bWJlcixcbiAgICAgICAgaGVpZ2h0OiB0eXBlcy5udW1iZXJcbiAgICB9LFxuXG4gICAgZ2V0RGVmYXVsdFByb3BzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB2ZXJzaW9uOiAnMS4xJyxcbiAgICAgICAgICAgIHhtbG5zOiAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLFxuICAgICAgICAgICAgdGV4dDogbnVsbCxcbiAgICAgICAgICAgIHdpZHRoOiAyNDAsXG4gICAgICAgICAgICBoZWlnaHQ6IDEyMFxuICAgICAgICB9O1xuICAgIH0sXG5cbiAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IHMgPSB0aGlzLFxuICAgICAgICAgICAgcHJvcHMgPSBzLnByb3BzO1xuXG4gICAgICAgIGxldCBjb2xvciA9ICcjNTU1JztcbiAgICAgICAgbGV0IHRleHQgPSBwcm9wcy50ZXh0LnNwbGl0KCcnKS5tYXAoKGxldHRlciwgaSwgbGV0dGVycyk9PiB7XG4gICAgICAgICAgICBsZXQgaW5kaWNlcyA9IFswLCAxLCAyLCAzLCA0LCA1XSxcbiAgICAgICAgICAgICAgICByZWFsID0gcmFuZG9tdmFsLnJhbmRvbUludCgwLCBpbmRpY2VzLmxlbmd0aCAtIDEpO1xuXG4gICAgICAgICAgICBsZXQgdGV4dHMgPSBpbmRpY2VzLm1hcCgoaikgPT4ge1xuICAgICAgICAgICAgICAgIGxldCByYXRlID0gKGkgKyAwLjUpIC8gbGV0dGVycy5sZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgIGtleSA9IGBsZXR0ZXItJHtpfS0ke2p9YDtcbiAgICAgICAgICAgICAgICBpZiAoaiA9PT0gcmVhbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcy5fcmVuZGVyTGV0dGVyKGxldHRlciwgcmF0ZSwge1xuICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBrZXksXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxsOiBjb2xvclxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcy5fcmVuZGVyTGV0dGVyKHMuX2R1bW15TGV0dGVyKCksIHJhdGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleToga2V5LFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDogYHJnYmEoMjU1LDI1NSwyNTUsJHswLjAxICogTWF0aC5yYW5kb20oKX0pYFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgPGcga2V5PXtgbGV0dGVyLWdyb3VwLSR7aX1gfT57dGV4dHN9PC9nPlxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGxldCB3aWR0aCA9IHByb3BzLndpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0ID0gcHJvcHMuaGVpZ2h0O1xuICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPHN2ZyB2ZXJzaW9uPXtwcm9wcy52ZXJzaW9ufVxuICAgICAgICAgICAgICAgICB3aWR0aD17d2lkdGh9XG4gICAgICAgICAgICAgICAgIGhlaWdodD17aGVpZ2h0fVxuICAgICAgICAgICAgICAgICB2aWV3Qm94PXtgMCAwICR7d2lkdGh9ICR7aGVpZ2h0fWB9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPGc+XG4gICAgICAgICAgICAgICAgICAgIHt0ZXh0fVxuICAgICAgICAgICAgICAgIDwvZz5cbiAgICAgICAgICAgIDwvc3ZnPlxuICAgICAgICApXG4gICAgfSxcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBTcGVjc1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIF9yZW5kZXJMZXR0ZXI6IGZ1bmN0aW9uIChsZXR0ZXIsIHJhdGUsIHRleHRQcm9wcykge1xuICAgICAgICBsZXQgcyA9IHRoaXMsXG4gICAgICAgICAgICBwcm9wcyA9IHMucHJvcHM7XG5cbiAgICAgICAgbGV0IHBhZGRpbmcgPSA4O1xuXG4gICAgICAgIGxldCB3ID0gcHJvcHMud2lkdGggLSAocGFkZGluZyAqIDIpLFxuICAgICAgICAgICAgaCA9IHByb3BzLmhlaWdodDtcblxuICAgICAgICBsZXQgbW92ZVJhbmdlID0gbnVtY2FsLm1pbihoIC8gMTAsIDIwKSxcbiAgICAgICAgICAgIG1vdmUgPSByYW5kb212YWwucmFuZG9tSW50LmJpbmQocmFuZG9tdmFsLCBtb3ZlUmFuZ2UgKiAtMSwgbW92ZVJhbmdlKTtcblxuICAgICAgICBsZXQgeCA9IHBhZGRpbmcgKyB3ICogcmF0ZSArIG1vdmUoKSxcbiAgICAgICAgICAgIHkgPSBoIC8gMiArIG1vdmUoKSxcbiAgICAgICAgICAgIHJvdGF0ZSA9IHJhbmRvbXZhbC5yYW5kb21JbnQoLTQ1LCA0NSk7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDx0ZXh0IHg9e3h9XG4gICAgICAgICAgICAgICAgICB5PXt5fVxuICAgICAgICAgICAgICAgICAgZm9udFNpemU9e2gvM31cbiAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybT17YHJvdGF0ZSgke3JvdGF0ZX0sICR7eH0sICR7eX0pYH1cbiAgICAgICAgICAgICAgICB7Li4udGV4dFByb3BzfVxuICAgICAgICAgICAgPntsZXR0ZXJ9PC90ZXh0PlxuICAgICAgICApXG4gICAgfSxcblxuICAgIF9kdW1teUxldHRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBsZXR0ZXJzID0gXCIxMjM0NTY3ODkwYWJjZGVmZ1wiO1xuICAgICAgICBsZXQgbGVuID0gbGV0dGVycy5sZW5ndGg7XG4gICAgICAgIHJldHVybiBsZXR0ZXJzW3JhbmRvbXZhbC5yYW5kb21JbnQoMCwgbGVuIC0gMSldO1xuICAgIH1cblxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQXBDYXB0Y2hhU3ZnO1xuIl19